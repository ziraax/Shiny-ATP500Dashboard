---
title: "Versus"
output: html_document
---

```{r}

# Load necessary libraries
library(dplyr)
library(tidyr)

match_data <- read.csv("../data/atp_tennis.csv")
player_data <- read.csv("../data/players_stats.csv")




# Merge match data with player data for Player_1 and Player_2
merged_data <- data %>%
  left_join(player_data, by = c("Player_1" = "Player")) %>%
  left_join(player_data, by = c("Player_2" = "Player"), suffix = c("_1", "_2"))

# Check for missing values
sum(is.na(merged_data))

# Create new features
merged_data <- merged_data %>%
  mutate(
    rank_diff = Rank_1 - Rank_2,
    wins_percent_diff = Wins_percent_1 - Wins_percent_2,
    hard_wins_percent_diff = Hard_wins_percent_1 - Hard_wins_percent_2,
    clay_wins_percent_diff = Clay_wins_percent_1 - Clay_wins_percent_2,
    grass_wins_percent_diff = Grass_wins_percent_1 - Grass_wins_percent_2
  )



# Set seed for reproducibility
set.seed(123)

# Split data into training (80%) and testing (20%)
train_index <- sample(1:nrow(merged_data), 0.8 * nrow(merged_data))
train_data <- merged_data[train_index, ]
test_data <- merged_data[-train_index, ]

```





```{r}
# Load necessary libraries
library(caret)

# Define the target variable (Winner: 1 if Player_1 wins, 0 if Player_2 wins)
train_data$target <- ifelse(train_data$Winner == train_data$Player_1, 1, 0)
test_data$target <- ifelse(test_data$Winner == test_data$Player_1, 1, 0)

# logistic regression model
model <- glm(target ~ rank_diff + wins_percent_diff + hard_wins_percent_diff +
               clay_wins_percent_diff + grass_wins_percent_diff,
             data = train_data, family = binomial())

# Summarize the model
summary(model)
```

```{r}
# Predict probabilities on the test set
test_data$pred_prob <- predict(model, test_data, type = "response")

# Convert probabilities to binary predictions (0 or 1)
test_data$pred_winner <- ifelse(test_data$pred_prob > 0.5, 1, 0)

# Evaluate the model
confusionMatrix(factor(test_data$pred_winner), factor(test_data$target))
```

```{r}
# Example: Predict for a new match
new_match <- data.frame(
  rank_diff = 10,
  wins_percent_diff = 5,
  hard_wins_percent_diff = 3,
  clay_wins_percent_diff = -2,
  grass_wins_percent_diff = 1
)

# Predict probability
pred_prob <- predict(model, new_match, type = "response")
pred_winner <- ifelse(pred_prob > 0.5, "Player_1", "Player_2")

cat("Predicted Winner:", pred_winner, "\n")
cat("Probability of Player_1 winning:", pred_prob)
```

